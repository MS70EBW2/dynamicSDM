<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Extract spatially buffered and temporally dynamic explanatory variable data for occurrence
records. — extract_buffered_coords • dynamicSDM</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Extract spatially buffered and temporally dynamic explanatory variable data for occurrence
records. — extract_buffered_coords"><meta property="og:description" content="For each species occurrence record co-ordinate and date, spatially buffered and temporally dynamic
explanatory data are extracted using Google Earth Engine."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">dynamicSDM</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/vig0.html">vig0</a>
    </li>
    <li>
      <a href="../articles/vignette1_response_data.html">dynamicSDM: Response variable data</a>
    </li>
    <li>
      <a href="../articles/vignette2_explanatory_data.html">dynamicSDM: Explanatory variable data</a>
    </li>
    <li>
      <a href="../articles/vignette3_modelling.html">dynamicSDM: model fitting and autocorrelation</a>
    </li>
    <li>
      <a href="../articles/vignette4_projecting.html">dynamicSDM: dynamic distribution projections</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Extract spatially buffered and temporally dynamic explanatory variable data for occurrence
records.</h1>
    
    <div class="hidden name"><code>extract_buffered_coords.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>For each species occurrence record co-ordinate and date, spatially buffered and temporally dynamic
explanatory data are extracted using Google Earth Engine.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">extract_buffered_coords</span><span class="op">(</span></span>
<span>  <span class="va">occ.data</span>,</span>
<span>  <span class="va">datasetname</span>,</span>
<span>  <span class="va">bandname</span>,</span>
<span>  <span class="va">spatial.res.metres</span>,</span>
<span>  <span class="va">GEE.math.fun</span>,</span>
<span>  <span class="va">moving.window.matrix</span>,</span>
<span>  <span class="va">user.email</span>,</span>
<span>  <span class="va">save.method</span>,</span>
<span>  <span class="va">varname</span>,</span>
<span>  <span class="va">temporal.res</span>,</span>
<span>  <span class="va">temporal.level</span>,</span>
<span>  <span class="va">temporal.direction</span>,</span>
<span>  <span class="va">categories</span>,</span>
<span>  <span class="va">save.directory</span>,</span>
<span>  <span class="va">agg.factor</span>,</span>
<span>  prj <span class="op">=</span> <span class="st">"+proj=longlat +datum=WGS84"</span>,</span>
<span>  resume <span class="op">=</span> <span class="cn">T</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>occ.data</dt>
<dd><p>a data frame, with columns for occurrence record co-ordinates and dates with
column names as follows; record longitude as "x", latitude as "y", year as "year", month as
"month", and day as "day".</p></dd>


<dt>datasetname</dt>
<dd><p>a character string, the Google Earth Engine dataset to extract data from.</p></dd>


<dt>bandname</dt>
<dd><p>a character string, the Google Earth Engine dataset bandname to extract data for.</p></dd>


<dt>spatial.res.metres</dt>
<dd><p>a numeric value, the spatial resolution in metres for data extraction.</p></dd>


<dt>GEE.math.fun</dt>
<dd><p>a character string, the mathematical function to compute across the specified
spatial matrix and period for each record.</p></dd>


<dt>moving.window.matrix</dt>
<dd><p>a matrix of weights with an odd number of sides, representing the
spatial neighbourhood of cells (“moving window”) to calculate <code>GEE.math.fun</code> across from record
co-ordinate. See details for more information.</p></dd>


<dt>user.email</dt>
<dd><p>a character string, user email for initialising Google Drive.</p></dd>


<dt>save.method</dt>
<dd><p>a character string, the method used to save extracted variable data. One of
<code>split</code> or <code>combined</code>: can be abbreviated. See details.</p></dd>


<dt>varname</dt>
<dd><p>optional; a character string, a unique name for the explanatory variable. Default
varname is “bandname_temporal.res_temporal.direction_GEE.math.fun_buffered".</p></dd>


<dt>temporal.res</dt>
<dd><p>optional; a numeric value, the temporal resolution in days to extract data and
calculate <code>GEE.math.fun</code> across from occurrence record date.</p></dd>


<dt>temporal.level</dt>
<dd><p>a character string, the temporal resolution of the explanatory variable
data. One of <code>day</code>, <code>month</code> or <code>year</code>: can be abbreviated. Default; <code>day.</code></p></dd>


<dt>temporal.direction</dt>
<dd><p>optional; a character string, the temporal direction for extracting data
across relative to the record date. One of <code>prior</code> or <code>post</code>: can be abbreviated.</p></dd>


<dt>categories</dt>
<dd><p>optional; a character string, the categories to use in calculation if data are
categorical. See details for more information.</p></dd>


<dt>save.directory</dt>
<dd><p>a character string, path to a local directory to save extracted variable
data to.</p></dd>


<dt>agg.factor</dt>
<dd><p>optional; a numeric value, the factor to aggregate data by before spatial
buffering.</p></dd>


<dt>prj</dt>
<dd><p>a character string, the coordinate reference system of <code>occ.data</code> coordinates.Default
is "+proj=longlat +datum=WGS84".</p></dd>


<dt>resume</dt>
<dd><p>a logical indicating whether to search <code>save.directory</code> and return to previous
progress. Only possible if save.method = <code>split</code> has previously and currently been employed.
Default = T.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>Returns details of successful explanatory variable extractions.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>For each individual species occurrence record co-ordinate and date, this function
extracts data for a given band within a Google Earth Engine dataset across a user-specified
spatial buffer and temporal period and calculates a mathematical function on such data.</p>
    </div>
    <div id="temporal-dimension">
    <h2>Temporal dimension</h2>
    <p>If <code>temporal.res</code> and <code>temporal.direction</code> are not given, the function
extracts explanatory variable data for all of the cells surrounding and including the cell
containing the occurrence record co-ordinates.</p>
<p>If <code>temporal.res</code> and <code>temporal.direction</code> is given, the function extracts explanatory variable
data for which <code>GEE.math.fun</code> has been first calculated over this period in relation to the
occurrence record date.</p>
    </div>
    <div id="spatial-dimension">
    <h2>Spatial dimension</h2>
    <p>Using the <code>focal</code> function from <code>raster</code> R package (Hijmans et al., 2015), <code>GEE.math.fun</code> is
calculated across the spatial buffer area from the record co-ordinate. The spatial buffer area
used is specified by the argument <code>moving.window.matrix</code>, which dictates the neighbourhood of
cells surrounding the cell containing the occurrence record to include in this calculation.</p>
<p>See function <code><a href="get_moving_window.html">get_moving_window()</a></code> to generate appropriate <code>moving.window.matrix</code>.</p>
    </div>
    <div id="mathematical-function">
    <h2>Mathematical function</h2>
    <p><code>GEE.math.fun</code> specifies the mathematical function to be calculated over the spatial buffered
area and temporal period. Options are limited to Google Earth Engine ImageCollection Reducer
functions (<a href="https://developers.google.com/earth-engine/apidocs/" class="external-link">https://developers.google.com/earth-engine/apidocs/</a>) for which an analogous R
function is available. This includes: "allNonZero","anyNonZero", "count",
"first","firstNonNull", "last", "lastNonNull", "max","mean", "median","min", "mode","product",
"sampleStdDev", "sampleVariance", "stdDev", "sum" and "variance".</p>
    </div>
    <div id="categorical-data">
    <h2>Categorical data</h2>
    <p>When explanatory variable data are categorical (e.g. land cover classes), argument <code>categories</code>
can be used to specify the categories of importance to the calculation. The category or
categories given will be converted in a binary representation, with “1” for those listed, and
“0” for all others in the dataset. Ensure that the <code>GEE.math.fun</code> given is appropriate for such
data. For example, the sum of suitable land cover classified cells across the “moving window”
from the species occurrence record co-ordinates.</p>
    </div>
    <div id="categorical-data-and-temporally-dynamic-variables">
    <h2>Categorical data and temporally dynamic variables</h2>
    <p>Please be aware, at current this function does not support the extraction of temporally dynamic
variables for categorical datasets. However, some accepted mathematical functions such as
"first" or "last" may be appropriate for such datasets.</p>
    </div>
    <div id="temporal-level-to-extract-data-at-temporal-level-states-the-temporal-resolution-of-the">
    <h2>Temporal level to extract data at <code>temporal.level</code> states the temporal resolution of the</h2>
    <p>explanatory variable data and improves the speed of <code>extract_buffered_coords()</code> extraction. For
example, if the explanatory data represents an annual variable, then all record co-ordinates
from the same year can be extracted from the same buffered raster, saving computation time.
However, if the explanatory data represents a daily variable, then only records from the exact
same day can be extracted from the same raster. For the former, <code>temporal.level</code> argument should
be <code>year</code> and for the latter, <code>temporal.level</code> should be <code>day</code>.</p>
    </div>
    <div id="google-earth-engine">
    <h2>Google Earth Engine</h2>
    <p><code>extract_buffered_coords()</code> requires users to have installed R package <code>rgee</code> (Aybar et al.,
2020) and initialised Google Earth Engine with valid log-in credentials. Please follow
instructions on the following website
<a href="https://cran.r-project.org/web/packages/rgee/vignettes/rgee01.html" class="external-link">https://cran.r-project.org/web/packages/rgee/vignettes/rgee01.html</a>.</p><ul><li><p><code>datasetname</code> must be in the accepted Google Earth Engine catalogue layout (e.g.
“MODIS/006/MCD12Q1” or “UCSB-CHG/CHIRPS/DAILY”)</p></li>
<li><p><code>bandname</code> must be as specified under the
dataset in the Google Earth Engine catalogue (e.g. “LC_Type5”, “precipitation”). For datasets
and band names, see <a href="https://developers.google.com/earth-engine/datasets" class="external-link">https://developers.google.com/earth-engine/datasets</a>.</p></li>
</ul></div>
    <div id="google-drive">
    <h2>Google Drive</h2>
    <p><code>extract_buffered_coords()</code> also requires users to have installed the R package
<code>googledrive</code>(D'Agostino McGowan and Bryan, 2022) and initialised Google Drive with valid log-in
credentials, which must be stated using argument <code>user.email</code>. Please follow instructions on
<a href="https://googledrive.tidyverse.org/" class="external-link">https://googledrive.tidyverse.org/</a> for initialising the <code>googledrive</code> package.</p>
<p>Note: When running this function a folder labelled "dynamicSDM_download_bucket" will be created
in your Google Drive. This will be emptied once the function has finished running and output
rasters will be found in the save.drive.folder or save.directory specified.</p>
    </div>
    <div id="exporting-extracted-data">
    <h2>Exporting extracted data</h2>
    <p>For <code>save.method</code> = <code>combined</code>, the function with save “csv” files containing all occurrence
records and associated values for the explanatory variable.</p>
<p>For <code>save.method</code> = <code>split</code>, the function will save individual “csv” files for each record with
each unique period of the given temporal.level (e.g. each year, each year and month combination
or each unique date).</p>
<p><code>split</code> protects users if internet connection is lost when extracting data for large occurrence
datasets. The argument <code>resume</code> can be used to resume to previous progress if connection is
lost.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Aybar, C., Wu, Q., Bautista, L., Yali, R. and Barja, A., 2020. rgee: An R package for
interacting with Google Earth Engine. Journal of Open Source Software, 5(51), p.2272.</p>
<p>D'Agostino McGowan L., and Bryan J., 2022. googledrive: An Interface to Google Drive.
<a href="https://googledrive.tidyverse.org" class="external-link">https://googledrive.tidyverse.org</a>, <a href="https://github.com/tidyverse/googledrive" class="external-link">https://github.com/tidyverse/googledrive</a>.</p>
<p>Hijmans, R. J., Van Etten, J., Cheng, J., Mattiuzzi, M., Sumner, M., Greenberg, J. A.,
Lamigueiro, O. P., Bevan, A., Racine, E. B. &amp; Shortridge, A. 2015. Package ‘raster’. R package,
734.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># googledrive::drive_has_token()</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">sample_filt_data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># \dontshow{</span></span></span>
<span class="r-in"><span><span class="va">sample_filt_data</span><span class="op">&lt;-</span><span class="va">sample_filt_data</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span></span></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">user.email</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu">gargle</span><span class="fu">::</span><span class="fu"><a href="https://gargle.r-lib.org/reference/gargle_oauth_sitrep.html" class="external-link">gargle_oauth_sitrep</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">email</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">matrix</span><span class="op">&lt;-</span><span class="fu"><a href="get_moving_window.html">get_moving_window</a></span><span class="op">(</span>radial.distance <span class="op">=</span> <span class="fl">10000</span>,</span></span>
<span class="r-in"><span>                            spatial.res.degrees <span class="op">=</span> <span class="fl">0.05</span>,</span></span>
<span class="r-in"><span>                            spatial.ext <span class="op">=</span> <span class="va">sample_extent_data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">extract_buffered_coords</span><span class="op">(</span>occ.data <span class="op">=</span> <span class="va">sample_filt_data</span>,</span></span>
<span class="r-in"><span>                      datasetname <span class="op">=</span> <span class="st">"MODIS/006/MCD12Q1"</span>,</span></span>
<span class="r-in"><span>                      bandname <span class="op">=</span> <span class="st">"LC_Type5"</span>,</span></span>
<span class="r-in"><span>                      spatial.res.metres <span class="op">=</span> <span class="fl">500</span>,</span></span>
<span class="r-in"><span>                      GEE.math.fun <span class="op">=</span> <span class="st">"sum"</span>,</span></span>
<span class="r-in"><span>                      moving.window.matrix<span class="op">=</span><span class="va">matrix</span>,</span></span>
<span class="r-in"><span>                      user.email <span class="op">=</span> <span class="va">user.email</span>,</span></span>
<span class="r-in"><span>                      save.method <span class="op">=</span><span class="st">"split"</span>,</span></span>
<span class="r-in"><span>                      temporal.level <span class="op">=</span> <span class="st">"year"</span>,</span></span>
<span class="r-in"><span>                      categories <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>,<span class="fl">7</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                      agg.factor <span class="op">=</span> <span class="fl">12</span>,</span></span>
<span class="r-in"><span>                      varname <span class="op">=</span> <span class="st">"total_grass_crop_lc"</span>,</span></span>
<span class="r-in"><span>                      save.directory <span class="op">=</span> <span class="fu">temp.dir</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Rachel Dobson, Andy J. Challinor, Robert A. Cheke, Stewart Jennings, Stephen G. Willis, Martin Dallimer.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

